<%- include("../partials/header") %>
<%- include("../partials/navbar") %>

<div class="container">
    <div class="thumbnail">

        <h1><%= post.title %></h1>
        <h6><%= post.author.username %></h6>
        <h6><%= post.created.toLocaleString(); %></h6>
        <p class="caption-full"><%- post.description %></p>
        <% if(currentUser && post.author.id.equals(currentUser._id)) { %>
        <a href="/posts/<%= post._id %>/edit">Edit</a>
        <div>
            <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
                <button class="btn btn-danger">Delete</button>
            </form>
        </div>
        <% } %>        
    </div>

    <div>
        <model-viewer class="a"
            src="https://firebasestorage.googleapis.com/v0/b/eduar-5dcad.appspot.com/o/models%2F<%= post.author.id %>%2F<%= post.uuid %>%2F<%= post.filename %>?alt=media&token=<%= post.uuid %>"
            alt="A 3D model of an astronaut"
            background-color="#FF6F59"
            shadow-intensity="1"
            camera-controls
            auto-rotate
            style="width: 1000px; height: 600px;">
        </model-viewer>
    </div>

    <div class="well">    
        <div class="text-right">
            <a class="btn btn-primary" href="/posts/<%= post._id %>/comments/new">New Comment</a>
        </div>
        <hr>
        <% post.comments.forEach( (comment) => { %>
            <div class="row">
                <div class="col-md-12">
                    <strong><%= comment.author.username %></strong>
                    <p><%= comment.text %></p>
                    <span class="pull-right">10 days ago</span>
                    <% if(currentUser && comment.author.id.equals(currentUser._id)) { %>
                    <a class="btn btn-xs btn-warning" href="/posts/<%= post._id %>/comments/<%= comment._id %>/edit">Edit</a>
                    <form action="/posts/<%= post._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
                        <button class="btn btn-xs btn-danger" type="submit">Delete</button>
                    </form>
                    <% } %>
                </div>
            </div>
            <hr>
            
        <% }); %>
    </div>
            


</div>
<%- include("../partials/footer") %>